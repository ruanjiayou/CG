<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
    <meta name="Author" content="阮家友"/>
    <meta name="Keywords" content="HTML,model,test"/>
    <meta name="Description" content="special effect model"/>
    <meta name="time" content="2015-9-27 10:41:48"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"/>
	<title>test</title>
    <link rel="stylesheet" href="css/reset.css"/>
    <script src="js/jquery.js"></script>
    <script src="js/Core.js"></script>
    <script src="js/DropImage.js"></script>
    <script src="js/CGraph.js"></script>
    <script src="js/CGraph.hough.js"></script>
    <script src="js/CColor.js"></script>
    <script src="js/CGraph.offset.js"></script>
    <script src="js/CGraph.grey.js"></script>
    <script src="js/CGraph.gauss.js"></script>
    <script src="js/CGraph.candy.js"></script>
    <script src="amcharts/amcharts.js" type="text/javascript"></script>
    <script src="amcharts/serial.js" type="text/javascript"></script> 
    <script src="形态学/morphology.js"></script>
    <style>
        #center {padding:2rem;}
        #div1 { min-height: 100px; background-color: #ccc; }
    </style>
</head>
<body>
    <div id="div1">
        <div>把图片拖到这里来！</div>
    </div>
        <div id="chartdiv" style="width:80%;height:400px;"></div>
<script>
//报表对象
var chart;
//报表的数据
var chartData = [
    {
        "value": 1,
        "angle": 10
    }
];


AmCharts.ready(function () {
    // SERIAL CHART  柱状图或曲线图  饼图是 pieChart()
    chart = new AmCharts.AmSerialChart();
    //chart.dataProvider = chartData;
    chart.categoryField = "value";//x轴对应的json数组中的项            
    chart.rotate = false;//柱子是横的还是竖着的  true 横着 false 竖着
    //柱状图或曲线图的宽度  chart.colomuwidth 0-1之间  1-4 0.1  4-8 0.5 8-x 1
    //chart.columnSpacing = 0    每组有多列 控制列间的空隙 设置 stackType = 3d 后此属性无效了
    // 控制3d效果
    chart.depth3D = 20;
    chart.angle = 30;
    //动画效果
    //chart.startDuration = 1;//动态特效

    // AXES
    // Category  x轴设置
    var categoryAxis = chart.categoryAxis;
    //categoryAxis.title="各县牛羊屠宰数量";   并不好用  不如自己写div
    categoryAxis.gridPosition = "start";
    categoryAxis.axisColor = "#666";//x轴
    categoryAxis.fillAlpha = 1;
    categoryAxis.gridAlpha = 0;
    categoryAxis.fillColor = "#FAFAFA";//柱子背景阴影
    
    //多Y轴  graph.valueAxis = valueAxisNxxx;
    // value  y轴
    var valueAxis = new AmCharts.ValueAxis();
    //valueAxis的 minimum属性  y轴起始值  <------------------------ 2017-3-24 16:02:59 minimum不如maximum
    //每组有多列 列纵向 排列 valueAxis.stackType = "3d";
    valueAxis.axisColor = "#555";//y轴
    valueAxis.title = "直线检测";
    valueAxis.position = "left";//y轴标题位置
    valueAxis.gridAlpha = 0.1;
    valueAxis.unit = "°"
    valueAxis.unitPosition = "right";//单位位置
    //valueAxis1.gridAlpha = 0;  y轴不要网格标尺
    chart.addValueAxis(valueAxis);

    // GRAPH
    var graph = new AmCharts.AmGraph();
    graph.title = "Income";
    graph.valueField = "angle";
    graph.type = "column";
    //graph 曲线图 图表 ：line  smoothedLine  step  column candlestick  ohlc
    graph.balloonText = "距离[[category]]:角度[[value]]";
    graph.lineAlpha = 0;
    graph.fillColors = "#0c0";
    graph.fillAlphas = 1;
    chart.addGraph(graph);
    //图例 如每年的收入支出 :绿色 income  蓝色 expensive
    var legend = new AmCharts.AmLegend();
    legend.useGraphSettings = true;
    chart.addLegend(legend);

    // WRITE
    //chart.write("chartdiv");
});
DropImage({
    selector: "#div1",
    callback: showPrevImg
})
function showPrevImg(src){
    var odiv1 = this;
    odiv1.innerHTML = "<div>把图片拖到这里来！</div>";
    var obj = new CCanvas(NewNode("canvas")).proprety({
        "stokeStyle": "#666",
        "fillStyle": "#1f77b4",
        "font": "16px Arial",
        "textAlign": "center"
    });
    //拓展方法
    obj.extend("binarize",binarize);
    obj.extend("getThreshold",getThreshold);
    odiv1.appendChild(obj.mCanvas);
    obj.load(src,function(){
        //this.drawLine({"x1":10,"y1":10,"x2":100,"y2":100});
        //this.each(this.medianFilter);//.render();
        //灰化+高斯模糊
        GaussR = 3;
        Gs = this.getGaussArr(GaussR);
        this.each(this.grey).each(this.rowGauss).each(this.colGauss);
        //显示结果
        this.appendA2B(this.createCanvas(this.mData),odiv1);
        //梯度 压制非最大信号 边缘连接
        this.each(Gradient).each(uMaxSignal).each(applyGradient);
        //显示结果
        this.appendA2B(this.createCanvas(this.mData),odiv1);
        sum=sum/count;
        highThreshold = sum*2;
        lowThreshold = highThreshold/4;
        this.each(initEdge).binarize(highThreshold);
        //显示结果
        this.appendA2B(this.createCanvas(this.mData),odiv1);
        //霍夫直线检测
        var lines = this.GetHoughLine();
        console.log(lines);
        chart.dataProvider = lines;
        chart.write("chartdiv");
    });
}
    
</script>
</body>
</html>
